'use strict';
var chalk = require('chalk');
var cleanConsole = require('./tools/cleanConsole');
var path = require('path');
var Server = require('karma').Server;

var argv = process.argv.slice(2);


var reporters = ['mocha'];

if (argv.indexOf('--coverage') > -1) {
    reporters.push('coverage-istanbul');
}

var karmaConfig = {
    port: 9876,
    configFile: path.resolve(__dirname, '../config/karma.conf.js'),
    reporters : reporters
}

var server = new Server(karmaConfig, function(exitCode) {
    console.log('Karma has exited with ' + exitCode)
    process.exit(exitCode)
});

server.on('run_start', function (browser) {
    cleanConsole();
    console.log(chalk.green('Test Running...'));
    console.log('使用 ' + chalk.cyan('npm test --coverage') + ' 生成覆盖率报告.');
})

server.start();
